<div class="container mt-5">
  <div class="card shadow">
    <div class="card-body">
      <h3 class="mb-4 text-center">ðŸ“‚ Liste des documents</h3>

      <!-- * Table des documents -->
      <table class="table table-bordered table-hover align-middle">

        <!-- * En-tÃªte de la table -->
        <thead class="table-dark">
          <tr>
            <th>Nom document</th>
            <th>CatÃ©gorie</th>
            <th class="d-none d-md-table-cell">Description</th> <!-- MasquÃ©e sur mobile -->
            <th>Date</th>
            <th class="d-none d-md-table-cell">Ouvrir</th> <!-- MasquÃ©e sur mobile -->
            <th>TÃ©lÃ©charger</th>
          </tr>
        </thead>

        <!-- * Corps de la table -->
        <tbody>
          <!-- ! Liste des documents (BOUCLE) -->
          <% documents.forEach(doc => { %>
            <tr>
              <td><%= doc.name %></td>

              <!-- ! CatÃ©gorie avec badge de couleur -->
              <td>
                <% 
                  let catColor = "secondary"; // couleur par dÃ©faut
                  switch (doc.category.name) {
                    case "Techniques de pose":
                      catColor = "primary"; // bleu
                      break;
                    case "HygiÃ¨ne et sÃ©curitÃ©":
                      catColor = "danger"; // rouge
                      break;
                    case "Produits et matÃ©riaux":
                      catColor = "success"; // vert
                      break;
                    case "Design et nail art":
                      catColor = "info"; // turquoise
                      break;
                    case "Gestion de salon":
                      catColor = "warning"; // jaune
                      break;
                    case "RÃ¨glementation et normes":
                      catColor = "dark"; // noir/gris foncÃ©
                      break;
                    default:
                      catColor = "secondary"; // gris si non listÃ©e
                                }
                %>
                <span class="badge bg-<%= catColor %>"><%= doc.category.name %></span>
              </td>

              <!-- ! Description -->
              <td class="d-none d-md-table-cell"><%= doc.description %></td>

              <!-- ! Formatage de la date en franÃ§ais -->
              <td><%= new Date(doc.created_at).toLocaleDateString("fr-FR") %></td>

              <!-- ! Bouton "Ouvrir" -->
              <td class="d-none d-md-table-cell">
                <% if (doc.fileName) { %>
                  <% 
                  <!-- TODO: RÃ©cupÃ©ration de l'extension du fichier -->
                    const ext = doc.fileName.split('.').pop().toLowerCase();
                    const wordFormats = ['doc','docx','txt','odt'];
                  %>

                  <!-- TODO: Affichage du document selon son type -->
                  <% if (['pdf','jpg','jpeg','png','gif'].includes(ext)) { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } else if (wordFormats.includes(ext)) { %>
                    <% const fileUrl = encodeURIComponent('https://ava-snailpo-1.onrender.com/uploads/' + doc.fileName); %>
                    <a href="https://docs.google.com/gview?url=<%= fileUrl %>&embedded=true" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } else { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } %>

                <% } else { %>
                  Aucun fichier
                <% } %>
              </td>

              <!-- ! Bouton TÃ©lÃ©charger -->
              <td>
                <% if (doc.fileName) { %>
                  <a href="/uploads/<%= doc.fileName %>" class="btn btn-sm btn-primary" download>TÃ©lÃ©charger</a>
                <% } else { %>
                  N/A
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- * Bouton Ajouter un document (visible uniquement par les admins) -->
<% if (user.admin === true) { %>
<div class="text-center mt-3">
  <a href="/ajout-document" class="btn btn-success">Ajouter un document</a>
</div>
<% } %>
