<div class="container mt-5">
  <div class="card shadow">
    <div class="card-body">
      <h3 class="mb-4 text-center">ðŸ“‚ Liste des documents</h3>

      <table class="table table-bordered table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>Nom document</th>
            <th>CatÃ©gorie</th>
            <th class="d-none d-md-table-cell">Description</th> <!-- MasquÃ©e sur mobile -->
            <th>Date</th>
            <th class="d-none d-md-table-cell">Ouvrir</th> <!-- MasquÃ©e sur mobile -->
            <th>TÃ©lÃ©charger</th>
          </tr>
        </thead>
        <tbody>
          <% documents.forEach(doc => { %>
            <tr>
              <td><%= doc.name %></td>
              <td><%= doc.category.name %></td>
              <td class="d-none d-md-table-cell"><%= doc.description %></td>
              <td><%= new Date(doc.created_at).toLocaleDateString("fr-FR") %></td>

              <!-- Bouton "Ouvrir" -->
              <td class="d-none d-md-table-cell">
                <% if (doc.fileName) { %>
                  <% 
                    const ext = doc.fileName.split('.').pop().toLowerCase();
                    const wordFormats = ['doc','docx','txt','odt'];
                  %>

                  <% if (['pdf','jpg','jpeg','png','gif'].includes(ext)) { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-info">Ouvrir</a>
                  <% } else if (wordFormats.includes(ext)) { %>
                    <% const fileUrl = encodeURIComponent('http://localhost:3000/uploads/' + doc.fileName); %>
                    <a href="https://docs.google.com/gview?url=<%= fileUrl %>&embedded=true" target="_blank" class="btn btn-sm btn-info">Ouvrir</a>
                  <% } else { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-info">Ouvrir</a>
                  <% } %>

                <% } else { %>
                  Aucun fichier
                <% } %>
              </td>

              <!-- Bouton TÃ©lÃ©charger -->
              <td>
                <% if (doc.fileName) { %>
                  <a href="/uploads/<%= doc.fileName %>" class="btn btn-sm btn-primary" download>TÃ©lÃ©charger</a>
                <% } else { %>
                  N/A
                <% } %>
              </td>

            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<% if (user.admin === true) { %>
<div class="text-center mt-3">
  <a href="/ajout-document" class="btn btn-success">Ajouter un document</a>
</div>
<% } %>
