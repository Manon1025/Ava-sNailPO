<div class="container mt-5">
  <div class="card shadow">
    <div class="card-body">
      <h3 class="mb-4 text-center">üìÇ Liste des documents</h3>

      <!-- * Table des documents -->
      <table class="table table-bordered table-hover align-middle">

        <!-- * En-t√™te de la table -->
        <thead class="table-dark">
          <tr>
            <th>Nom document</th>
            <th>Cat√©gorie</th>
            <th class="d-none d-md-table-cell">Description</th> <!-- Masqu√©e sur mobile -->
            <th>Date</th>
            <th class="d-none d-md-table-cell">Ouvrir</th> <!-- Masqu√©e sur mobile -->
            <th>T√©l√©charger</th>

            <% if(user.role === 1) { %>
            <th>Actions</th>
            <% } %>

          </tr>
        </thead>

        <!-- * Corps de la table -->
        <tbody>
          <!-- ! Liste des documents (BOUCLE) -->
          <% documents.forEach(doc => { %>
            <tr>
              <td><%= doc.name %></td>

              <!-- ! Cat√©gorie avec badge de couleur -->
              <td>
                <% 
                  let catClass = "badge-default"; // classe par d√©faut
                  if (doc.Category && doc.Category.name) {
                    switch (doc.Category.name) {
                      case "R√©glement int√©rieur":
                        catClass = "badge-reglement";
                        break;
                      case "Hygi√®ne & S√©curit√©":
                        catClass = "badge-hygiene";
                        break;
                      case "Produit & Mat√©riel":
                        catClass = "badge-produits";
                        break;
                      case "Prestations":
                        catClass = "badge-prestations";
                        break;
                      case "Formation & Dipl√¥me":
                        catClass = "badge-formation";
                        break;
                      case "Accueil & Client":
                        catClass = "badge-accueil";
                        break;
                      case "Administration":
                        catClass = "badge-administration";
                        break;
                      case "Organisation":
                        catClass = "badge-organisation"; 
                        break;
                      case "Equipe & Communication":
                        catClass = "badge-equipe"; 
                        break;
                      case "Qualit√© & Satisfaction client":
                        catClass = "badge-qualite"; 
                        break;
                      case "Ev√©nement & Promotions":
                        catClass = "badge-event"; 
                        break;
                      case "Sant√© & Bien-√™tre au travail":
                        catClass = "badge-sante"; 
                        break;
                      case "Mention L√©gale & RGPD":
                        catClass = "badge-mention"; 
                        break;
                      default:
                        catClass = "badge-default";
                    }
                  }
                %>
                <span class="badge <%= catClass %>">
                  <%= doc.Category && doc.Category.name ? doc.Category.name : 'Non d√©finie' %>
                </span>
              </td>

              <!-- ! Description -->
              <td class="d-none d-md-table-cell"><%= doc.description %></td>

              <!-- ! Formatage de la date en fran√ßais -->
              <td>
                <% if (doc.create_at) { %>
                  <%= new Date(doc.create_at).toLocaleDateString("fr-FR") %>
                <% } else { %>
                  Non d√©finie
                <% } %>
              </td>

              <!-- ! Bouton "Ouvrir" -->
              <td class="d-none d-md-table-cell">
                <% if (doc.fileName) { %>
                  <% 
                    // R√©cup√©ration de l'extension du fichier
                    const ext = doc.fileName.split('.').pop().toLowerCase();
                  %>

                  <%// Affichage du document selon son type %>
                  <% if (['pdf','jpg','jpeg','png','gif'].includes(ext)) { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } else { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } %>
                <% } else { %>
                  Aucun fichier
                <% } %>
              </td>

              <!-- ! Bouton T√©l√©charger -->
              <td>
                <% if (doc.fileName) { %>
                  <a href="/uploads/<%= doc.fileName %>" class="btn btn-sm btn-primary" download>T√©l√©charger</a>
                <% } else { %>
                  Aucun fichier
                <% } %>
              </td>

              <% if(user.role === 1) { %>
              <td>
                <button class="btn btn-sm btn-info me-1">Modifier</button>
                <form action="/delete-document/<%= doc.id_document %>" method="POST" class="d-inline" 
                      onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer ce document ?')">
                  <button class="btn btn-sm btn-danger">Supprimer</button>
                </form>
              </td>
              <% } %>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- * Bouton Ajouter un document (visible uniquement par les admins) -->
<% if (user.role === 1 ) { %>
<div class="text-center mt-3">
  <a href="/ajout-document" class="btn btn-success">Ajouter un document</a>
</div>
<% } %>
