<div class="container mt-5">
  <div class="card shadow">
    <div class="card-body">
      <h3 class="mb-4 text-center">üìÇ Liste des documents</h3>

      <!-- * Table des documents -->
      <table class="table table-bordered table-hover align-middle">

        <!-- * En-t√™te de la table -->
        <thead class="table-dark">
          <tr>
            <th>Nom document</th>
            <th>Cat√©gorie</th>
            <th class="d-none d-md-table-cell">Description</th> <!-- Masqu√©e sur mobile -->
            <th>Date</th>
            <th class="d-none d-md-table-cell">Ouvrir</th> <!-- Masqu√©e sur mobile -->
            <th>T√©l√©charger</th>
          </tr>
        </thead>

        <!-- * Corps de la table -->
        <tbody>
          <!-- ! Liste des documents (BOUCLE) -->
          <% documents.forEach(doc => { %>
            <tr>
              <td><%= doc.name %></td>

              <!-- ! Cat√©gorie avec badge de couleur -->
              <td>
                <% 
                  let catColor = "secondary"; // couleur par d√©faut
                  if (doc.Category && doc.Category.name) {
                    switch (doc.Category.name) {
                      case "R√©glement int√©rieur":
                        catColor = "primary"; // bleu
                        break;
                      case "Hygi√®ne et s√©curit√©":
                        catColor = "danger"; // rouge
                        break;
                      case "Produits et mat√©riaux":
                        catColor = "success"; // vert
                        break;
                      case "Prestations":
                        catColor = "info"; // turquoise
                        break;
                      case "Formation & Dipl√¥me":
                        catColor = "warning"; // jaune
                        break;
                      case "Techniques de pose":
                        catColor = "dark"; // noir/gris fonc√©
                        break;
                      case "Design et nail art":
                        catColor = "light text-dark"; // gris clair avec texte fonc√©
                        break;
                      case "Gestion de salon":
                        catColor = "primary"; // bleu (alternative)
                        break;
                      case "R√®glementation et normes":
                        catColor = "secondary"; // gris
                        break;
                      default:
                        catColor = "outline-secondary"; // contour gris pour les non d√©finies
                    }
                  }
                %>
                <span class="badge bg-<%= catColor %>">
                  <%= doc.Category && doc.Category.name ? doc.Category.name : 'Non d√©finie' %>
                </span>
              </td>

              <!-- ! Description -->
              <td class="d-none d-md-table-cell"><%= doc.description %></td>

              <!-- ! Formatage de la date en fran√ßais -->
              <td>
                <% if (doc.create_at) { %>
                  <%= new Date(doc.create_at).toLocaleDateString("fr-FR") %>
                <% } else { %>
                  Non d√©finie
                <% } %>
              </td>

              <!-- ! Bouton "Ouvrir" -->
              <td class="d-none d-md-table-cell">
                <% if (doc.fileName) { %>
                  <% 
                  <!-- TODO: R√©cup√©ration de l'extension du fichier -->
                    const ext = doc.fileName.split('.').pop().toLowerCase();
                    const wordFormats = ['doc','docx','txt','odt'];
                  %>

                  <!-- TODO: Affichage du document selon son type -->
                  <% if (['pdf','jpg','jpeg','png','gif'].includes(ext)) { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } else if (wordFormats.includes(ext)) { %>
                    <% const fileUrl = encodeURIComponent('https://ava-snailpo-1.onrender.com/uploads/' + doc.fileName); %>
                    <a href="https://docs.google.com/gview?url=<%= fileUrl %>&embedded=true" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } else { %>
                    <a href="/uploads/<%= doc.fileName %>" target="_blank" class="btn btn-sm btn-warning">Ouvrir</a>
                  <% } %>

                <% } else { %>
                  Aucun fichier
                <% } %>
              </td>

              <!-- ! Bouton T√©l√©charger -->
              <td>
                <% if (doc.fileName) { %>
                  <a href="/uploads/<%= doc.fileName %>" class="btn btn-sm btn-primary" download>T√©l√©charger</a>
                <% } else { %>
                  N/A
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- * Bouton Ajouter un document (visible uniquement par les admins) -->
<% if (user.role === 1 ) { %>
<div class="text-center mt-3">
  <a href="/ajout-document" class="btn btn-success">Ajouter un document</a>
</div>
<% } %>
